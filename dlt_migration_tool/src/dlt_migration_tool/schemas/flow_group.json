{
    "title": "Flow DataFlowSpec FlowGroup",
    "type": "object",
    "properties": {
        "dataFlowId": {"type": "string"},
        "flowGroupId": {"type": "string"},
        "stagingTables": {"$ref": "#/definitions/stagingTables"},
        "flows": {
            "type": "object",
            "patternProperties": {
                "f_([A-Za-z0-9_]+)": {
                    "type": "object",
                    "properties": {
                        "enabled": {"type": "boolean"},
                        "flowType": {"type": "string", "enum": ["append_view", "append_sql", "merge"]},
                        "flowDetails": {"type": "object"},
                        "views": {"$ref": "#/definitions/views"}
                    },
                    "required": ["flowType", "flowDetails"],
                    "dependentSchemas": {
                        "flowType": { "$ref": "./definitions_flows.json#/flowType"}
                    }
                }
            },
            "additionalProperties": false
        }
    },
    "required": ["flowGroupId", "flows"],
    "additionalProperties": false,
    "definitions": {
        "stagingTables": {
            "additionalProperties": {
                "type": "object",
                "properties": {
                    "type": {"type": "string", "enum": ["ST", "MV"]},
                    "database": {"type": "string"}
                },
                "dependentSchemas": {
                    "type": {
                        "oneOf": [
                            {
                                "properties": {
                                    "type": {"const": "ST"},
                                    "database": {"type": "string"},
                                    "schemaPath": {"type": "string", "pattern": "\\.(json|ddl)$"},
                                    "tableProperties": {"type": "object"},
                                    "path": {"type": "string"},
                                    "partitionColumns": {"type": "array", "items": {"type": "string"}},
                                    "clusterByColumns": {"type": "array", "items": {"type": "string"}},
                                    "cdcSettings": {"$ref": "./definitions_main.json#/definitions/cdcSettings"},
                                    "cdcSnapshotSettings": {"$ref": "./definitions_main.json#/definitions/cdcSnapshotSettings"}
                                },
                                "additionalProperties": false
                            },
                            {
                                "properties": {
                                    "type": {"const": "MV"},
                                    "database": {"type": "string"},
                                    "schemaPath": {"type": "string", "pattern": "\\.(json|ddl)$"},
                                    "tableProperties": {"type": "object"},
                                    "path": {"type": "string"},
                                    "partitionColumns": {"type": "array", "items": {"type": "string"}},
                                    "clusterByColumns": {"type": "array", "items": {"type": "string"}},
                                    "sourceView": {"type": "string"}
                                },
                                "additionalProperties": false,
                                "required": ["sourceView"]
                            },
                            {
                                "properties": {
                                    "type": {"const": "MV"},
                                    "database": {"type": "string"},
                                    "schemaPath": {"type": "string", "pattern": "\\.(json|ddl)$"},
                                    "tableProperties": {"type": "object"},
                                    "path": {"type": "string"},
                                    "partitionColumns": {"type": "array", "items": {"type": "string"}},
                                    "clusterByColumns": {"type": "array", "items": {"type": "string"}},
                                    "sqlPath": {"type": "string"}
                                },
                                "additionalProperties": false,
                                "required": ["sqlPath"]
                            },
                            {
                                "properties": {
                                    "type": {"const": "MV"},
                                    "database": {"type": "string"},
                                    "schemaPath": {"type": "string", "pattern": "\\.(json|ddl)$"},
                                    "tableProperties": {"type": "object"},
                                    "path": {"type": "string"},
                                    "partitionColumns": {"type": "array", "items": {"type": "string"}},
                                    "clusterByColumns": {"type": "array", "items": {"type": "string"}},
                                    "sqlStatement": {"type": "string"}
                                },
                                "additionalProperties": false,
                                "required": ["sqlStatement"]
                            }
                        ]
                    }
                },
                "required": ["type"]
            }
        },
        "views": {
            "type": "object",
            "patternProperties": {
                "v_([A-Za-z0-9_]+)": {
                    "type": "object",
                    "properties": {
                        "mode": {"type": "string", "enum": ["batch", "stream"]},
                        "sourceType": {"type": "string", "enum": ["batchFiles", "cloudFiles", "delta", "deltaJoin", "kafka", "python", "sql"]},
                        "sourceDetails": {"type": "object"}
                    },
                    "dependentSchemas": {
                        "sourceType": { "$ref": "./definitions_sources.json#/sourceType"}
                    },
                    "required": ["mode", "sourceType", "sourceDetails"]
                }
            },
            "additionalProperties": false
        }
    }
}